<link rel='stylesheet' type='text/css' href='/fullcalendar/fullcalendar.css' />
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script type='text/javascript' src='/fullcalendar/fullcalendar.js'></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  
  

<head>

 <script type="text/javascript">
	var encryptedData=<%= raw @contents %>;
	var encryptedContent= new Array();
	for (var i=0; i<encryptedData.length; i++) {
	  encryptedContent[i]=encryptedData[i]['event']['content'];
	}
	
	for (var i=0; i<encryptedData.length; i++) {
	  encryptedContent[i] = encryptedContent[i].replace(/[ \r\n]+/g,'')
	}
	var unencryptedData=encryptionHelpers.unencryptAll(encryptedContent);
	var unencryptedEvents=new Array();
	for(var i=0; i < unencryptedData.length;i++){
		unencryptedEvents[i]=jQuery.parseJSON(unencryptedData[i]);
		unencryptedEvents[i]['id']=encryptedData[i]['event']['id'];
	}
  </script>	

<script type="text/javascript">
$(document).ready(function() {

    // page is now ready, initialize the calendar...
	
    $('#calendar').fullCalendar({
	
        // put your options and callbacks here
		header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay'
			},
			 height: 650,
			 events:[],
		eventClick: function(calEvent, jsEvent, view) {
			  $("#dialog").dialog({ modal: true });
			  
			  $('.ui-widget-overlay').click(function() { $("#dialog").dialog("close"); });

        // change the border color just for fun
        $(this).css('border-color', 'red');

    }
			
    })
	var events1=initializeEvents();
	$('#calendar').fullCalendar( 'addEventSource', events1 )
});

function initializeEvents(){
	var events=new Array();
	for(var i=0; i < unencryptedEvents.length; i++){
		var event=unencryptedEvents[i];
		var eventDict={};
		eventDict['title']=event['name'];

		eventDict['start']= $.fullCalendar.formatDate(new Date(event['startTime']), "yyyy-MM-dd HH:mm:ss");
		eventDict['end']= $.fullCalendar.formatDate(new Date(event['endTime']), "yyyy-MM-dd HH:mm:ss");
		eventDict['allDay']=false // will make the time show
		events[i]=eventDict;
	}
	return events;
}

</script>
</head>
<div id='calendar'></div>
<div id="dialog" title="Dialog Title"></div>
